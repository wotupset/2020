<!DOCTYPE html>
<html>
<head>
<title>title</title>
<meta charset="UTF-8" />
<style>
body{
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function(event) {
  console.log( 'DOMContentLoaded' );
  var jsElm = document.createElement("script");
  jsElm.type = "application/javascript";
  jsElm.src = 'https://code.jquery.com/jquery-3.4.1.min.js';
  //jsElm.integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  jsElm.onload = function(e){
    console.log('jsElm.onload');
	//id01.insertAdjacentHTML('afterbegin', 'jquery讀取成功');
	poi();
  };
  //document.body.appendChild(jsElm);
  document.head.appendChild(jsElm);
});//DOMContentLoaded

function poi(){

	//
	$(document).ready(function() {
		console.log('document.ready');
		time = new Date();
		//
		poi_ajax();
		//poi();
		poi2();
	});//document).ready

}//poi()

function poi_ajax(){ 
  var cc=0;
  var cc2=0;
  $( document ).ajaxStart(function() {
    console.log( 'ajaxStart' );
  });
  $(document).ajaxComplete(function(event, xhr, settings ) { // event, xhr, settings
    cc2++;
    //console.log( 'ajaxComplete',cc2 );
    //console.log( event, xhr, settings );
	if( xhr.status == 200 ){
		//console.log( xhr.status );
		$("pre").html("<b>("+cc2+") "+ xhr.responseJSON.url +"</b>"); //較慢
	}else{
		//console.log( xhr.status );
		$("pre").html("<b>("+cc2+") 錯誤</b>"); //較慢
	}
	//settings.url
	//

  });
  $(document).ajaxStop(function() {
    console.log( 'ajaxStop' );
	//
	if( $('blockquote.twitter-tweet').length > 0 ){
		if(cc ==0){
			console.log( '第一次執行' );
			cc++;
			poi_getjs();
		}else{
			console.log( '什麼都不執行' );
		}
	}
  });
  $(document).ajaxError(function() {
    console.log( 'ajaxError' );
  });
  
  
}//poi_ajax()
//poi_ajax()


function poi2(){
	var qq=$("pre").text();
	$("pre").html("<b>讀取測試</b>");
	qq=qq.replace(/\r\n/g, "\n");
	qq=qq.split("\n");
	qq=qq.filter(Boolean);
	qq.sort(); //依帳號排序
	//console.log( qq );
	var url_id=[];
	var url_array=[];
	var url_array_2=[];
	var url_array_3=[];
	var cc=0;
	for(i=0;i<qq.length;i++){
		//console.log( qq[i] );
		var aa=poi2b( qq[i] ); //檢查網址
		//console.log( aa ); //收到的回傳值
		if(url_id.includes( aa[1] )){
			//有=重複
			console.log( '重複id',aa[1] );
		}else{
			//無=新的
			if( aa[1] == '跳過' ){
				//跳過
				console.log( aa ); 
			}else{
				url_id.push( aa[1] );//收集id
				url_array.push( aa[0] );//收集url
				cc++;
				url_array_2.push( {id: aa[1], url:aa[0] } );
			}
		}
	}
	//console.log( url_array );

	if( 0 ){
		//依照id大小排序
		//console.log( url_array_2 );排序前
		url_array_2=url_array_2.sort(function(a,b){
			//console.log( a.id,b.id );
			return a.id - b.id;
		});
		//console.log( url_array_2 ); //排序後
		
		url_array_2.forEach(function(item,index){
			url_array_3.push( item.url );
		});
		//console.log( url_array_3 ); //取url
	}else{
		//不排序
		url_array_3=url_array;
	}
	
	
/*
	console.log( url_id );
	url_id=url_id.sort(function(a,b){
		//console.log( a,b );
		return a - b;
	});
	console.log( url_id );
	
	for(i=0;i<url_id.length;i++){
		var aa = url_array.findIndex(function(x){
			return x.includes( url_id[i] );
		});
		console.log( aa,url_array[aa],url_id[i] );
		url_array_3.push( url_array[aa] );
	};
	console.log( url_array_3 );

*/
	

	
	for(i=0; i< url_id.length; i++){
		//poi3(url_array,i); //ajax處理網址
		
		poi3(url_array_3,i); //ajax處理網址
		//poi3( url_array_2.url ,i); //ajax處理網址
	}
}//poi2()
//
function poi2b(in1){//檢查網址
	//console.log( in1 );//網址
	var url= in1;
	//
	if( url.trim().length >0 ){
		//y
		//包含字串
	}else{
		//n
		cc++;
	}
	
	//
	var cc=0;
	var chk=url.includes("twitter.com");
	if(chk){
		//y
		//網址要包含twitter.com
	}else{
		//n
		cc++;
	}
	//
	var re = /status\/([0-9]{15,20})/;
	var res = url.match(re);
	//console.log( res );
	if(res){
		//y
		//網址要包含一串數字
	}else{
		//n
		cc++;
	}
	//
	if(cc>0){
		//驗證失敗
		url=''+url; //不改變
		id='跳過'; //id
	}else{
		//url="https://twitter.com/i/status/"+res[1];
		url=''+url; //不改變
		id=res[1]; //id
	}
	//
	var x=[];
	x[0]=url;
	x[1]=id;
	return x;
	
}//poi2b()
//poi2b()

function poi3( url_array,url_count ){  //步進顯示
	//let url_array=url_array;
	//let url_count=url_count;
	//
	//console.log( url_array[url_count] );

	//建立個別box
	var str1 = "box"+url_count;
	//var str2 = '<div id="'+str1+'">&emsp;'+pp+'</div>';
	//var str2 = '<div id="'+str1+'">&emsp;🔰&ensp;'+qq[pp]+'</div>';
	var FFF=url_count+1;
	var str2 = '<div id="'+str1+'">&emsp;🔰&ensp;'+ FFF +'</div>';
	//var str2 = '<a href="#'+str1+'">§░&emsp;🔰&ensp;'+url_count+'</a>';
	//str2='<div id="'+str1+'">'+str2+'</div>';
/*
&ZeroWidthSpace;
&zwnj;
&nbsp;  一般空格

&ensp;  半形空格
&emsp;  全形空格

https://emojipedia.org/symbols/
https://developer.wordpress.com/docs/photon/api/
https://i2.wp.com/pbs.twimg.com/media/EFSeU3yVAAAn1J1.jpg?fit=2048,2048


*/
	$("#ddd").append( str2 );
	var str3=$("#"+ str1 +"");
	//console.log( str1,str3 );

	//檢查網址
	if( url_array[url_count] ){
		var url='' + url_array[url_count];
	}else{
		console.log( '不存在網址1', url_array[url_count] );
		//throw "錯誤error";
		//poi4(url_array,url_count);//避免ajax延遲讀取變數
		//return;
	}
	if( url.length >0 ){
		//console.log(  );
	}else{
		console.log( '空字串' );
		//console.log( url2 );
	}
//////

try{
	var url2 = new URL(url);
	//console.log( url2 );
}
catch(err){
	//解讀網址失敗
	console.log( '解讀網址失敗2',url );
	//throw "錯誤error";
	//失敗就進行下一個
	//poi4(url_array,url_count);//避免ajax延遲讀取變數
	//return;
}
finally{}	
//////
	//console.log( url2 );
	//console.log( url2.pathname );
	
	
	
	
	//檢查網址//
	//取得oembed內容
	var jqxhr =$.ajax({
	type:     "GET",
	url:      "https://publish.twitter.com/oembed?url="+url,
	dataType: "jsonp",
	success: function(data,status,jqxhr){
		//console.log( data,status,jqxhr );
		//$("#box"+url_count ).append( $(data.html)[0] );
		//$("pre").html("<b>("+pp+"/"+qq.length+") "+ status +" "+qq[pp]+"</b>");
	},
	error: function( jqXHR, textStatus, errorThrown ){
		//console.log( jqXHR, textStatus, errorThrown );
		//$("#box"+url_count ).append( '錯誤1' );
	},
	complete:function(data,status,jqxhr){
		//console.log( pp,qq.length,qq[pp] );
		//console.log( $('.twitter-tweet').length , url_array.length );
		//讀取完 就讀取推特js
		//ajax裡的東西會延遲執行
		//url_array,url_count
		if( url_array.length == $('blockquote.twitter-tweet').length ){
			//發生錯誤會造成數量不同
			//poi_getjs();//讀取完 就讀取推特js
		}else{
		}
		if( url_count < (url_array.length-1)){
			//pp++;
			//poi3(qq,pp);
		}else{
			//poi_getjs();//讀取完 就讀取推特js
		}
		//
		
	},
	});//ajax
	
	
	jqxhr.done(function( data, textStatus, jqXHR ){//data,status,jqxhr
		//data, textStatus, jqXHR
		//console.log( a,b,c );
		//console.log( pp,qq.length,qq[pp] );
		//$("pre").html("<b>("+url_count+"/"+url_array.length+") "+b+" "+url_array[url_count]+"</b>"); //較慢
		//console.log( 'jqxhr.done' );
		$("#box"+url_count ).append( $(data.html)[0] );
	});
	jqxhr.fail(function( jqXHR, textStatus, errorThrown ){ //jqXHR, textStatus, errorThrown
		//console.log( a,b,c );
		//$("pre").html("<b>("+url_count+"/"+url_array.length+") 錯誤</b>");
		$("#box"+url_count ).append( '錯誤' + jqXHR.status );
		console.log( "錯誤error", jqXHR.status,url );
		if( jqXHR.status == '404' ){
			console.log( "這個推特不存在" );
		}else{
			console.log( "???" );
		}
		//throw "錯誤error";
		//throw new Error("錯誤error");
	});
	jqxhr.always(function(a,b,c){
		//總是
	});
	
	
	//處理下一個
	if(url_count < (url_array.length-1)){
		//poi4( url_array,url_count );//避免ajax延遲讀取變數
	}else{
		//poi_getjs();
	}
	//

  
}//poi3
//poi3

function poi4( url_array,url_count ){ //避免ajax延遲讀取變數 //不使用了
	url_count++;
	//let url_array=url_array;
	//let url_count=url_count;
	//console.log( 'url_count',url_count );
	if( url_count < url_array.length ){
		poi3( url_array, url_count );//避免ajax延遲讀取變數
	}else{
		//poi_getjs();
	}
	//
	//poi3(qq,pp);
}//poi4()
//poi4()


//function poi0(){}

function poi_getjs(){
	console.log( '讀取twitter的api' );
	//
	poi_191127(); //檢查元素變動
	//
    //var jqxhr=$.getScript("https://platform.twitter.com/widgets.js");
	var url='https://platform.twitter.com/widgets.js';
	//var url='http://ram.komica2.net/00/src/1575395734604.jpg';
	
	var jqxhr=$.ajax({
		url: url,
		type: 'get',
		dataType: "script", //設定成script 就不會傳給success handler //onprogress也沒反應
		cache: true, //啟用暫存設定
        global:false, //不觸發global事件
		
		//
		xhrFields: {
			onprogress: function(event){
				console.log('這是xhrFields',event ); //xhrFields優先顯示 //沒有收到total 不能做進度條
			},
		},
		//
		xhr: function () {
			//console.log('這是xhr');
			var xhr = $.ajaxSettings.xhr();
			console.log(xhr);
			xhr.onprogress = function(e) {
				console.log('這是xhr',e);
			};
			return xhr;
		},
		//


		//

	
	});	
	
	jqxhr.done(function(a,b,c){//data,status,jqxhr
		console.log( 'jqxhr.done' );
		$("pre").html("完成"); //清掉了網址
		//poi_191204(a); //dataType設定成script 就不用手動載入script
/*
		//var url2=url
		$.getScript( url,function(e){
			console.log("getScript callback"); //getScript不接受blob
		}); 
		//Not allowed to load local resource:

*/
		

    //
  });
}//poi_getjs()
//
function poi_191204(in1){
	console.log( 'poi_191204' );
	var a = in1;
	//
	var blob = new Blob([a],{type: 'text/javascript'});
	//console.log( blob );
	var url = window.URL.createObjectURL(blob);
	console.log( url );
	var box = $('<script/>',{id: 'js_191204',});
	//console.log( box );
	$("pre").after( box ); //增加新元素
	box = $('#js_191204');
	console.log( box );

	box.attr('src',url); //載入了js
	console.log( box );
	
	window.URL.revokeObjectURL(url); //解除blob url
	console.log( url );


	if(0){
		var id01=document.getElementById('ppp');
		//var id01=document.getElementsByTagName("pre")[0];
		id01.insertAdjacentHTML('beforebegin', 'beforebegin');
		id01.insertAdjacentHTML('afterbegin', 'afterbegin');
		id01.insertAdjacentHTML('beforeend', 'beforeend');
		id01.insertAdjacentHTML('afterend', 'afterend');
		//console.log( id01.outerHTML );
	}else{
		//$("pre").hide();
		//var aa=$('div');
		//var aa=$('blockquote.twitter-tweet');
		//console.log( aa );
		//poi_191127();
		//$("pre").html("完成"); //清掉了網址
	}
}//poi_191204()
//poi_191204()
function poi_191127(){
/*
https://wangdoc.com/javascript/dom/mutationobserver.html
Mutation Observer API 用来监视 DOM 变动。DOM 的任何变动，比如节点的增减、属性的变动、文本内容的变动，这个 API 都可以得到通知。
*/

	const observer = new MutationObserver(function(mutations, observer){
		mutations.forEach(function(mutation) {
			//console.log(mutation); //列舉變動
		});	
	});
	var article = document.querySelector('div');
	//var article = document; //整個網頁
	
	var options = {
	  'attributes':true,
	  'characterData':true,
	  'childList': true,
	  'subtree':true,
	  'attributeOldValue':true,
	  'characterDataOldValue':true,
	  'attributeFilter':['class','src'],
	} ;
	observer.observe(article, options);
	//observer.disconnect();
}//poi_191127()
//poi_191127()


  
  







</script>

	</head>
	<body>
	
<pre id="ppp">

200219+

https://twitter.com/shirofox/status/1143670558841638912
https://twitter.com/tofu_bam/status/1227537304849272835
https://twitter.com/TusTusHR/status/1227653612664283136
https://twitter.com/kidojiru/status/1227396915681095680
https://twitter.com/deme_is_deme/status/1227505320596869120
https://twitter.com/kani_biimu/status/1227552661530038272
https://twitter.com/imas_cg_cool/status/1227753801987301377
https://twitter.com/ukiwakisen/status/1225389422209716224
https://twitter.com/pop_KOME/status/1227179608102948866
https://twitter.com/sabu_iris/status/1227447717405896711
https://twitter.com/a_la_koala/status/1222826732073340930
https://twitter.com/yan_nn00/status/1227623866979123200
https://twitter.com/icccch/status/1227661495749595136
https://twitter.com/izumiyuhina/status/1227730336915656704
https://twitter.com/march_work/status/1227551786472329216
https://twitter.com/tomorrow_0/status/1227605915337015298
https://twitter.com/seaocean01251/status/1227787079955836928
https://twitter.com/ren_sukiari/status/1227783790912688128
https://twitter.com/krosa1028/status/1218120789158842375
https://twitter.com/llll_NNMN/status/1227753300080021504
https://twitter.com/cylinder_f/status/1215922801128787969
https://twitter.com/minori_chigusa/status/1226402028403904513
https://twitter.com/anoanoa0127/status/1227579335449538562
https://twitter.com/Seic_Oh/status/943323771443617792
https://twitter.com/hiepita97/status/1227920443698380800
https://twitter.com/yuzuma107/status/1228001134205210624
https://twitter.com/fjsking/status/1227996363838767104
https://twitter.com/rimukoro/status/1228155112570310656
https://twitter.com/priconne_redive/status/1228136797688881152
https://twitter.com/mi_398/status/1228170491669540866
https://twitter.com/R_E_I_/status/1228185984820338690
https://twitter.com/0721gomen1919/status/1227976234178473988
https://twitter.com/misonor/status/1227775561709187073
https://twitter.com/sakurapion/status/1228244588223090688
https://twitter.com/PlayStation_jp/status/1228189626126356480
https://twitter.com/piromizu/status/1228276753518362624
https://twitter.com/la__pioggia/status/1228214915892047874
https://twitter.com/nagumo_yui/status/1228199445558222850
https://twitter.com/wooperfuri/status/1228163205211410433
https://twitter.com/okazakiokaa/status/1226159167297032192
https://twitter.com/k_asahi07/status/1228151937536688128
https://twitter.com/pomujoynet1/status/1228160981789884416
https://twitter.com/wwwrkgk/status/1228149598473994240
https://twitter.com/yaponishi/status/1228129334675697664
https://twitter.com/ko_ru_ri/status/1228125376552980480
https://twitter.com/mayusuki_osr/status/1228076500710084608
https://twitter.com/mayusuki_osr/status/1219213830519021568
https://twitter.com/mayusuki_osr/status/1216480288038998016
https://twitter.com/momomi_mmm/status/1228272845530095616
https://twitter.com/nanananananasea/status/1226994825120997377
https://twitter.com/anti1096187/status/1225666409637629952
https://twitter.com/teigi_3/status/1228333609431384064
https://twitter.com/donkubota1/status/1228309489218048000
https://twitter.com/kahasina9/status/1228306776895803392
https://twitter.com/karoti_/status/1228278879371948033
https://twitter.com/kosmone/status/1228330379808890882
https://twitter.com/miyase_mahiro/status/1228264732987027456
https://twitter.com/go_1tk/status/1228350642931896320
https://twitter.com/kildirnoir/status/1226130459580493835
https://twitter.com/ainy120/status/1228160236197793794
https://twitter.com/mob_oji_katu/status/1228304987811221509
https://twitter.com/kildirnoir/status/1215983669891850246
https://twitter.com/otmm/status/1228540901439369216
https://twitter.com/coconeeeco/status/1228301066262863872
https://twitter.com/gurasion0310/status/1228279747207057408
https://twitter.com/eluthel/status/1228348129247842305
https://twitter.com/done_kanda/status/1227901896259563520
https://twitter.com/mill_plant/status/1228309210116440064
https://twitter.com/socnissoc/status/1228275693181497345
https://twitter.com/daiji_1031/status/1228617097560743936
https://twitter.com/toranoew/status/1228598573526216704
https://twitter.com/toythefishing/status/1228578392758292480
https://twitter.com/myuliy0210/status/1228254883393892354
https://twitter.com/myuliy0210/status/1225375375598862336
https://twitter.com/athynel/status/1228740636091674625
https://twitter.com/siwaa0419/status/1228698105878499328
https://twitter.com/momo_inu/status/1228293758518562817
https://twitter.com/hageind/status/1219693385843232768
https://twitter.com/hitsukuya/status/1228949160843530240
https://twitter.com/w1lm1/status/1228718909898969089
https://twitter.com/rokushoujy/status/1228902947624349698
https://twitter.com/horosuke_/status/1227956824621473793
https://twitter.com/adahemas/status/1228822811558346753
https://twitter.com/minori_chigusa/status/1228951179855458304
https://twitter.com/eerieXeery/status/1229037684988858368
https://twitter.com/Pg45FAVaoi6lRid/status/1228497492313964545
https://twitter.com/1RBOX_CCC/status/1229082452657704960
https://twitter.com/1rbox_ccc/status/1229082452657704960
https://twitter.com/0721gomen1919/status/1229052756339478529
https://twitter.com/tenoo12/status/1229032918913208322
https://twitter.com/tsugaru_hobby/status/1226110264057028608
https://twitter.com/_yatsuki/status/1218351768477655040
https://twitter.com/wat_son_/status/1229066948022943746
https://twitter.com/aidairo2009/status/1222852628524060672
https://twitter.com/yuf_uL_0428/status/1229222620484096000
https://twitter.com/ixy/status/1229263245115969536
https://twitter.com/k_yuizaki/status/1229355805717123073
https://twitter.com/wwwrkgk/status/1229344604673077251
https://twitter.com/rits_meg/status/1229367209337618432
https://twitter.com/onkbkbk/status/1229010064670748672
https://twitter.com/nekokota_koume/status/1229264873541881856
https://twitter.com/NanalynXD/status/1229462363394330625
https://twitter.com/rikyou_moe/status/1229430163135270913
https://twitter.com/decent_black/status/1229430091060400128
https://twitter.com/hibiki_linasha/status/1229430116758872064
https://twitter.com/deretta/status/1229368816003469312
https://twitter.com/deretta/status/1229368816003469312
https://twitter.com/inagakiyasuto/status/1229359176301678593
https://twitter.com/moketa11/status/1229461960283963393
https://twitter.com/tara_zoo/status/1229643026433134592
https://twitter.com/thecoh8/status/1229536011493027844
https://twitter.com/routo_katsu/status/1229438632714334208
https://twitter.com/matayosi/status/1206511491341381632
https://twitter.com/matayosi/status/1209796082605015041
https://twitter.com/sorawoyumemiru/status/1229373545748152320
https://twitter.com/3zerry9/status/1229743999277133828
https://twitter.com/3zerry9/status/1228672478785896448
https://twitter.com/done_kanda/status/1229725196984045569
https://twitter.com/mp26player/status/1229702656714629120
https://twitter.com/hamao_freelife/status/1229733441383493632
https://twitter.com/yayaa_00/status/1229664469984272390
https://twitter.com/Hamao_freelife/status/1229702310646796288
https://twitter.com/yayaa_00/status/1213745918861668353
https://twitter.com/_mimo_lm/status/1229738389496201216
https://twitter.com/zuhonyanko/status/1229733469342896130
https://twitter.com/_mimo_Lm/status/1227548161876451328
https://twitter.com/kawayabug/status/1229658095615299584
https://twitter.com/otmm/status/1229629127017127937
https://twitter.com/hanetsuka8250/status/1229601448654065664
https://twitter.com/hibiri_p/status/1229724820289413120
https://twitter.com/mammoth_2020/status/1229551290109198336
https://twitter.com/rr_aikatsu/status/1229749390123786240
https://twitter.com/RR_aikatsu/status/1229521136729251840
https://twitter.com/mammoth_2020/status/1229688575802789888
https://twitter.com/mammoth_2020/status/1228186772342890496
https://twitter.com/ko_ro_ne__u/status/1229747349452288001
https://twitter.com/kaoming775/status/1229696823754813440
https://twitter.com/knuck07/status/1229676113988685825
https://twitter.com/knuck07/status/1229676118195625984
https://twitter.com/shi2280/status/1229692072501792768
https://twitter.com/momomaromaron/status/1229391172327464960
https://twitter.com/k_mugura/status/1229736064232779776
https://twitter.com/mangatimekirara/status/1228232170998661122
https://twitter.com/Hazara_H/status/1229613315552239616
https://twitter.com/marinko6/status/1229782789874044934
https://twitter.com/_star_gazer__/status/1229376715140390912
https://twitter.com/0honekawa0/status/1229803497786200064
https://twitter.com/narunaru1320/status/1214557373513158658
https://twitter.com/nanban319/status/1226086402271531008


https://twitter.com/yume335/status/1228877975640166406
https://twitter.com/toutenkou10105/status/1200988384480546816
https://twitter.com/Resetovo/status/1223248117291601922
https://twitter.com/togokaeri/status/1229829451086622720
https://twitter.com/uuuunnnaa/status/1229692381131395077
https://twitter.com/teki_uto/status/1229775882006540288
https://twitter.com/momimomimin/status/1225032374523592706
https://twitter.com/tatami10jyo/status/1229805906197565441
https://twitter.com/kasa_7/status/1223961108135854080
https://twitter.com/sunghesung/status/1229343280829059073
https://twitter.com/sunghesung/status/1227160580764495874
https://twitter.com/azurlane_staff/status/1228136779779321858
https://twitter.com/jinsei_Konata/status/1229735885156970501
https://twitter.com/kinabusha/status/1229761618285752320
https://twitter.com/rikunow/status/1224663186067968000
https://twitter.com/waterkuma0/status/1229753931686768640



</pre>

<div id="ddd"></div>


	</body>
</html>
