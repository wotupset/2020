<!DOCTYPE html>
<html>
<head>
<title>title</title>
<meta charset="UTF-8" />
<style>
body{
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function(event) {
  console.log( 'DOMContentLoaded' );
  var jsElm = document.createElement("script");
  jsElm.type = "application/javascript";
  jsElm.src = 'https://code.jquery.com/jquery-3.4.1.min.js';
  //jsElm.integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  jsElm.onload = function(e){
    console.log('jsElm.onload');
	//id01.insertAdjacentHTML('afterbegin', 'jqueryè®€å–æˆåŠŸ');
	poi();
  };
  //document.body.appendChild(jsElm);
  document.head.appendChild(jsElm);
});//DOMContentLoaded

function poi(){

	//
	$(document).ready(function() {
		console.log('document.ready');
		time = new Date();
		//
		poi_ajax();
		//poi();
		poi2();
	});//document).ready

}//poi()

function poi_ajax(){ 
  var cc=0;
  var cc2=0;
  $( document ).ajaxStart(function() {
    console.log( 'ajaxStart' );
  });
  $(document).ajaxComplete(function(event, xhr, settings ) { // event, xhr, settings
    cc2++;
    //console.log( 'ajaxComplete',cc2 );
    //console.log( event, xhr, settings );
	if( xhr.status == 200 ){
		//console.log( xhr.status );
		$("pre").html("<b>("+cc2+") "+ xhr.responseJSON.url +"</b>"); //è¼ƒæ…¢
	}else{
		//console.log( xhr.status );
		$("pre").html("<b>("+cc2+") éŒ¯èª¤</b>"); //è¼ƒæ…¢
	}
	//settings.url
	//

  });
  $(document).ajaxStop(function() {
    console.log( 'ajaxStop' );
	//
	if( $('blockquote.twitter-tweet').length > 0 ){
		if(cc ==0){
			console.log( 'ç¬¬ä¸€æ¬¡åŸ·è¡Œ' );
			cc++;
			poi_getjs();
		}else{
			console.log( 'ä»€éº¼éƒ½ä¸åŸ·è¡Œ' );
		}
	}
  });
  $(document).ajaxError(function() {
    console.log( 'ajaxError' );
  });
  
  
}//poi_ajax()
//poi_ajax()

//ä¾ç…§idå¤§å°æ’åº
//ä¾å¸³è™Ÿæ’åº

function poi2(){
	var qq=$("pre").text();
	$("pre").html("<b>è®€å–æ¸¬è©¦</b>");
	qq=qq.replace(/\r\n/g, "\n");
	qq=qq.split("\n");
	qq=qq.filter(Boolean);
	//qq.sort(); //ä¾å¸³è™Ÿæ’åº
	//console.log( qq );
	var url_id=[];
	var url_array=[];
	var url_array_2=[];
	var url_array_3=[];
	var cc=0;
	for(i=0;i<qq.length;i++){
		//console.log( qq[i] );
		var aa=poi2b( qq[i] ); //æª¢æŸ¥ç¶²å€
		//console.log( aa ); //æ”¶åˆ°çš„å›å‚³å€¼
		if(url_id.includes( aa[1] )){
			//æœ‰=é‡è¤‡
			console.log( 'é‡è¤‡id',aa[1] );
		}else{
			//ç„¡=æ–°çš„
			if( aa[1] == 'è·³é' ){
				//è·³é
				console.log( aa ); 
			}else{
				url_id.push( aa[1] );//æ”¶é›†id
				url_array.push( aa[0] );//æ”¶é›†url
				cc++;
				url_array_2.push( {id: aa[1], url:aa[0] } );
			}
		}
	}
	//console.log( url_array );

	if( 1 ){
		//ä¾ç…§idå¤§å°æ’åº
		//console.log( url_array_2 );æ’åºå‰
		url_array_2=url_array_2.sort(function(a,b){
			//console.log( a.id,b.id );
			return a.id - b.id;
		});
		//console.log( url_array_2 ); //æ’åºå¾Œ
		
		url_array_2.forEach(function(item,index){
			url_array_3.push( item.url );
		});
		//console.log( url_array_3 ); //å–url
	}else{
		//ä¸æ’åº
		url_array_3=url_array;
	}
	
	
/*
	console.log( url_id );
	url_id=url_id.sort(function(a,b){
		//console.log( a,b );
		return a - b;
	});
	console.log( url_id );
	
	for(i=0;i<url_id.length;i++){
		var aa = url_array.findIndex(function(x){
			return x.includes( url_id[i] );
		});
		console.log( aa,url_array[aa],url_id[i] );
		url_array_3.push( url_array[aa] );
	};
	console.log( url_array_3 );

*/
	

	
	for(i=0; i< url_id.length; i++){
		//poi3(url_array,i); //ajaxè™•ç†ç¶²å€
		
		poi3(url_array_3,i); //ajaxè™•ç†ç¶²å€
		//poi3( url_array_2.url ,i); //ajaxè™•ç†ç¶²å€
	}
}//poi2()
//
function poi2b(in1){//æª¢æŸ¥ç¶²å€
	//console.log( in1 );//ç¶²å€
	var url= in1;
	//
	if( url.trim().length >0 ){
		//y
		//åŒ…å«å­—ä¸²
	}else{
		//n
		cc++;
	}
	
	//
	var cc=0;
	var chk=url.includes("twitter.com");
	if(chk){
		//y
		//ç¶²å€è¦åŒ…å«twitter.com
	}else{
		//n
		cc++;
	}
	//
	var re = /status\/([0-9]{15,20})/;
	var res = url.match(re);
	//console.log( res );
	if(res){
		//y
		//ç¶²å€è¦åŒ…å«ä¸€ä¸²æ•¸å­—
	}else{
		//n
		cc++;
	}
	//
	if(cc>0){
		//é©—è­‰å¤±æ•—
		url=''+url; //ä¸æ”¹è®Š
		id='è·³é'; //id
	}else{
		//url="https://twitter.com/i/status/"+res[1];
		url=''+url; //ä¸æ”¹è®Š
		id=res[1]; //id
	}
	//
	var x=[];
	x[0]=url;
	x[1]=id;
	return x;
	
}//poi2b()
//poi2b()

function poi3( url_array,url_count ){  //æ­¥é€²é¡¯ç¤º
	//let url_array=url_array;
	//let url_count=url_count;
	//
	//console.log( url_array[url_count] );

	//å»ºç«‹å€‹åˆ¥box
	var str1 = "box"+url_count;
	//var str2 = '<div id="'+str1+'">&emsp;'+pp+'</div>';
	//var str2 = '<div id="'+str1+'">&emsp;ğŸ”°&ensp;'+qq[pp]+'</div>';
	var FFF=url_count+1;
	var str2 = '<div id="'+str1+'">&emsp;ğŸ”°&ensp;'+ FFF +'</div>'; //+url_array[url_count]
	//var str2 = '<a href="#'+str1+'">Â§â–‘&emsp;ğŸ”°&ensp;'+url_count+'</a>';
	//str2='<div id="'+str1+'">'+str2+'</div>';
/*
&ZeroWidthSpace;
&zwnj;
&nbsp;  ä¸€èˆ¬ç©ºæ ¼

&ensp;  åŠå½¢ç©ºæ ¼
&emsp;  å…¨å½¢ç©ºæ ¼

https://emojipedia.org/symbols/
https://developer.wordpress.com/docs/photon/api/
https://i2.wp.com/pbs.twimg.com/media/EFSeU3yVAAAn1J1.jpg?fit=2048,2048


*/
	$("#ddd").append( str2 );
	var str3=$("#"+ str1 +"");
	//console.log( str1,str3 );

	//æª¢æŸ¥ç¶²å€
	if( url_array[url_count] ){
		var url='' + url_array[url_count];
	}else{
		console.log( 'ä¸å­˜åœ¨ç¶²å€1', url_array[url_count] );
		//throw "éŒ¯èª¤error";
		//poi4(url_array,url_count);//é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
		//return;
	}
	if( url.length >0 ){
		//console.log(  );
	}else{
		console.log( 'ç©ºå­—ä¸²' );
		//console.log( url2 );
	}
//////

try{
	var url2 = new URL(url);
	//console.log( url2 );
}
catch(err){
	//è§£è®€ç¶²å€å¤±æ•—
	console.log( 'è§£è®€ç¶²å€å¤±æ•—2',url );
	//throw "éŒ¯èª¤error";
	//å¤±æ•—å°±é€²è¡Œä¸‹ä¸€å€‹
	//poi4(url_array,url_count);//é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
	//return;
}
finally{}	
//////
	//console.log( url2 );
	//console.log( url2.pathname );
	
	
	
	
	//æª¢æŸ¥ç¶²å€//
	//å–å¾—oembedå…§å®¹
	var jqxhr =$.ajax({
	type:     "GET",
	url:      "https://publish.twitter.com/oembed?url="+url,
	dataType: "jsonp",
	success: function(data,status,jqxhr){
		//console.log( data,status,jqxhr );
		//$("#box"+url_count ).append( $(data.html)[0] );
		//$("pre").html("<b>("+pp+"/"+qq.length+") "+ status +" "+qq[pp]+"</b>");
	},
	error: function( jqXHR, textStatus, errorThrown ){
		//console.log( jqXHR, textStatus, errorThrown );
		//$("#box"+url_count ).append( 'éŒ¯èª¤1' );
	},
	complete:function(data,status,jqxhr){
		//console.log( pp,qq.length,qq[pp] );
		//console.log( $('.twitter-tweet').length , url_array.length );
		//è®€å–å®Œ å°±è®€å–æ¨ç‰¹js
		//ajaxè£¡çš„æ±è¥¿æœƒå»¶é²åŸ·è¡Œ
		//url_array,url_count
		if( url_array.length == $('blockquote.twitter-tweet').length ){
			//ç™¼ç”ŸéŒ¯èª¤æœƒé€ æˆæ•¸é‡ä¸åŒ
			//poi_getjs();//è®€å–å®Œ å°±è®€å–æ¨ç‰¹js
		}else{
		}
		if( url_count < (url_array.length-1)){
			//pp++;
			//poi3(qq,pp);
		}else{
			//poi_getjs();//è®€å–å®Œ å°±è®€å–æ¨ç‰¹js
		}
		//
		
	},
	});//ajax
	
	
	jqxhr.done(function( data, textStatus, jqXHR ){//data,status,jqxhr
		//data, textStatus, jqXHR
		//console.log( a,b,c );
		//console.log( pp,qq.length,qq[pp] );
		//$("pre").html("<b>("+url_count+"/"+url_array.length+") "+b+" "+url_array[url_count]+"</b>"); //è¼ƒæ…¢
		//console.log( 'jqxhr.done' );
		//console.log( $(data.html) );
		//$("#box"+url_count ).append( $(data.html)[0] );
		$("#box"+url_count ).append( $(data.html) );
	});
	jqxhr.fail(function( jqXHR, textStatus, errorThrown ){ //jqXHR, textStatus, errorThrown
		//console.log( a,b,c );
		//$("pre").html("<b>("+url_count+"/"+url_array.length+") éŒ¯èª¤</b>");
		$("#box"+url_count ).append( 'éŒ¯èª¤' + jqXHR.status );
		console.log( "éŒ¯èª¤error", jqXHR.status,url );
		if( jqXHR.status == '404' ){
			console.log( "é€™å€‹æ¨ç‰¹ä¸å­˜åœ¨" );
		}else{
			console.log( "???" );
		}
		//throw "éŒ¯èª¤error";
		//throw new Error("éŒ¯èª¤error");
	});
	jqxhr.always(function(a,b,c){
		//ç¸½æ˜¯
	});
	
	
	//è™•ç†ä¸‹ä¸€å€‹
	if(url_count < (url_array.length-1)){
		//poi4( url_array,url_count );//é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
	}else{
		//poi_getjs();
	}
	//

  
}//poi3
//poi3

function poi4( url_array,url_count ){ //é¿å…ajaxå»¶é²è®€å–è®Šæ•¸ //ä¸ä½¿ç”¨äº†
	url_count++;
	//let url_array=url_array;
	//let url_count=url_count;
	//console.log( 'url_count',url_count );
	if( url_count < url_array.length ){
		poi3( url_array, url_count );//é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
	}else{
		//poi_getjs();
	}
	//
	//poi3(qq,pp);
}//poi4()
//poi4()


//function poi0(){}

function poi_getjs(){
	console.log( 'è®€å–twitterçš„api' );
	//
	poi_191127(); //æª¢æŸ¥å…ƒç´ è®Šå‹•
	//
    //var jqxhr=$.getScript("https://platform.twitter.com/widgets.js");
	var url='https://platform.twitter.com/widgets.js';
	//var url='http://ram.komica2.net/00/src/1575395734604.jpg';
	
	var jqxhr=$.ajax({
		url: url,
		type: 'get',
		dataType: "script", //è¨­å®šæˆscript å°±ä¸æœƒå‚³çµ¦success handler //onprogressä¹Ÿæ²’åæ‡‰
		cache: true, //å•Ÿç”¨æš«å­˜è¨­å®š
        global:false, //ä¸è§¸ç™¼globaläº‹ä»¶
		
		//
		xhrFields: {
			onprogress: function(event){
				console.log('é€™æ˜¯xhrFields',event ); //xhrFieldså„ªå…ˆé¡¯ç¤º //æ²’æœ‰æ”¶åˆ°total ä¸èƒ½åšé€²åº¦æ¢
			},
		},
		//
		xhr: function () {
			//console.log('é€™æ˜¯xhr');
			var xhr = $.ajaxSettings.xhr();
			console.log(xhr);
			xhr.onprogress = function(e) {
				console.log('é€™æ˜¯xhr',e);
			};
			return xhr;
		},
		//


		//

	
	});	
	
	jqxhr.done(function(a,b,c){//data,status,jqxhr
		console.log( 'jqxhr.done' );
		$("pre").html("å®Œæˆ"); //æ¸…æ‰äº†ç¶²å€
		//poi_191204(a); //dataTypeè¨­å®šæˆscript å°±ä¸ç”¨æ‰‹å‹•è¼‰å…¥script
/*
		//var url2=url
		$.getScript( url,function(e){
			console.log("getScript callback"); //getScriptä¸æ¥å—blob
		}); 
		//Not allowed to load local resource:

*/
		

    //
  });
}//poi_getjs()
//
function poi_191204(in1){
	console.log( 'poi_191204' );
	var a = in1;
	//
	var blob = new Blob([a],{type: 'text/javascript'});
	//console.log( blob );
	var url = window.URL.createObjectURL(blob);
	console.log( url );
	var box = $('<script/>',{id: 'js_191204',});
	//console.log( box );
	$("pre").after( box ); //å¢åŠ æ–°å…ƒç´ 
	box = $('#js_191204');
	console.log( box );

	box.attr('src',url); //è¼‰å…¥äº†js
	console.log( box );
	
	window.URL.revokeObjectURL(url); //è§£é™¤blob url
	console.log( url );


	if(0){
		var id01=document.getElementById('ppp');
		//var id01=document.getElementsByTagName("pre")[0];
		id01.insertAdjacentHTML('beforebegin', 'beforebegin');
		id01.insertAdjacentHTML('afterbegin', 'afterbegin');
		id01.insertAdjacentHTML('beforeend', 'beforeend');
		id01.insertAdjacentHTML('afterend', 'afterend');
		//console.log( id01.outerHTML );
	}else{
		//$("pre").hide();
		//var aa=$('div');
		//var aa=$('blockquote.twitter-tweet');
		//console.log( aa );
		//poi_191127();
		//$("pre").html("å®Œæˆ"); //æ¸…æ‰äº†ç¶²å€
	}
}//poi_191204()
//poi_191204()
function poi_191127(){
/*
https://wangdoc.com/javascript/dom/mutationobserver.html
Mutation Observer API ç”¨æ¥ç›‘è§† DOM å˜åŠ¨ã€‚DOM çš„ä»»ä½•å˜åŠ¨ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„å¢å‡ã€å±æ€§çš„å˜åŠ¨ã€æ–‡æœ¬å†…å®¹çš„å˜åŠ¨ï¼Œè¿™ä¸ª API éƒ½å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚
*/

	const observer = new MutationObserver(function(mutations, observer){
		mutations.forEach(function(mutation) {
			//console.log(mutation); //åˆ—èˆ‰è®Šå‹•
		});	
	});
	var article = document.querySelector('div');
	//var article = document; //æ•´å€‹ç¶²é 
	
	var options = {
	  'attributes':true,
	  'characterData':true,
	  'childList': true,
	  'subtree':true,
	  'attributeOldValue':true,
	  'characterDataOldValue':true,
	  'attributeFilter':['class','src'],
	} ;
	observer.observe(article, options);
	//observer.disconnect();
}//poi_191127()
//poi_191127()


  
  







</script>

	</head>
	<body>
	
<pre id="ppp">


https://twitter.com/TorinoAqua/status/1244914755426373634
https://twitter.com/pinakoda/status/1243158554107719681
https://twitter.com/mojojoj27827860/status/1245127825465597952
https://twitter.com/ozakimakura69/status/1243454749359276033
https://twitter.com/ana_ame0/status/1236211519043407874
https://twitter.com/baniro__/status/1244906591033405440
https://twitter.com/Ixy/status/1245114597813583873
https://twitter.com/kinutani_yutaka/status/1232683290848481280
https://twitter.com/kinutani_yutaka/status/1227257349364051969
https://twitter.com/kinutani_yutaka/status/1222518175218061314
https://twitter.com/ukke_tori/status/1244481807669575681
https://twitter.com/amu9_kas11_/status/1244525970750500864
https://twitter.com/MomoKurihana/status/1245012235551830019
https://twitter.com/nade_gata/status/1244946359951581185
https://twitter.com/__fw108/status/1243860781034115074
https://twitter.com/__fw108/status/1216880664957468677
https://twitter.com/Nir7XD/status/1036262353476546560
https://twitter.com/cgmIM/status/1239569646820274176
https://twitter.com/tenoo12/status/1245279966880649217
https://twitter.com/uuuunnnaa/status/1245281261670879233
https://twitter.com/cluseller/status/1245086137393147906
https://twitter.com/MayCome_Dead/status/1245289193883852800
https://twitter.com/5thyear_ntkt/status/1245229778933669889
https://twitter.com/mikuzin24/status/1107199503902244864
https://twitter.com/ikurauni67/status/1244310756041998336
https://twitter.com/tikuwaumai_/status/1244547721224052736
https://twitter.com/majamari17/status/1244287689819443200
https://twitter.com/tikuwaumai_/status/1236563930291392515
https://twitter.com/7010_uraniwa/status/1245351132261527553
https://twitter.com/bookwormU/status/1245359123564089347
https://twitter.com/aikawa524/status/1244962305852313602
https://twitter.com/So_shi_te_/status/1242172607031422976
https://twitter.com/DSmile9/status/1241996348276092928
https://twitter.com/nigobox/status/1244322311580184576
https://twitter.com/BeniShake/status/1244249941716824064
https://twitter.com/kisumirei41/status/1245313263903989761
https://twitter.com/sofraaaaa/status/1245182288888909826
https://twitter.com/benishake/status/1244249941716824064
https://twitter.com/kani_biimu/status/1245339572646457352
https://twitter.com/17_narae/status/1245305912627085313
https://twitter.com/cjdcjd717/status/1245237650627297280
https://twitter.com/Toffee_lemon/status/1237842902396502019
https://twitter.com/Toffee_lemon/status/1107155140098678785
https://twitter.com/Toffee_lemon/status/1222791214572851200
https://twitter.com/shycocoa/status/1221839154226458624
https://twitter.com/Toffee_lemon/status/1215521718590033921
https://twitter.com/yorunogumo/status/1243552084865085447
https://twitter.com/yorunogumo/status/1229470246940987396
https://twitter.com/yorunogumo/status/1221806588387704832
https://twitter.com/emyo_/status/1244748743099838464
https://twitter.com/_jujumit/status/1244611434782183424
https://twitter.com/wagashi928/status/1245478464137744480
https://twitter.com/hasisisissy/status/1245371363684012033
https://twitter.com/n2hellhell/status/1245277414730551296
https://twitter.com/ree_kkr/status/1242790964722143234
https://twitter.com/ree_kkr/status/751813705281572864
https://twitter.com/mocoyaOvO/status/1245287485510307845
https://twitter.com/baniro__/status/1245376443908886528
https://twitter.com/gurasion0310/status/1245284808453808129
https://twitter.com/gurasion0310/status/1232983438296141825
https://twitter.com/nmk_mn97/status/1184067289450070016
https://twitter.com/roin_icom5/status/1180649795972562944
https://twitter.com/wuokb/status/1245522079685816322
https://twitter.com/ryukisukune/status/1243826471413485568
https://twitter.com/Seic_Oh/status/1245541636546809856
https://twitter.com/mine_gessyu/status/1245369381497868288
https://twitter.com/epi_zero/status/1245411896129290240
https://twitter.com/seic_oh/status/1245541636546809856
https://twitter.com/satoukabi/status/1245653618495082499
https://twitter.com/fbctwit/status/1245644161555955714
https://twitter.com/kuno_on/status/1206532534424592389
https://twitter.com/LOLI_Samurai/status/1198926699565436928
https://twitter.com/satomuch11/status/1243763891848368128
https://twitter.com/mpgatarimasen/status/853968085295837184
https://twitter.com/aleos696/status/1244747349949206528
https://twitter.com/wwwrkgk/status/1245689161840910336
https://twitter.com/done_kanda/status/1245675568990801922
https://twitter.com/ewkk_/status/1245744752525340672
https://twitter.com/mcmcmococo/status/1178486919686025219
https://twitter.com/mcmcmococo/status/1214121386014199809
https://twitter.com/mcmcmococo/status/1228229765942800385
https://twitter.com/mcmcmococo/status/1209677649481617409
https://twitter.com/mdxu/status/1246000923635138561
https://twitter.com/FOTS_JAPAN/status/1245999605205979136
https://twitter.com/mdxu/status/1234969806576578560
https://twitter.com/NAB0I/status/1219266950938783746
https://twitter.com/mdxu/status/1212328740216172545
https://twitter.com/12SprprS/status/1245500905660641281
https://twitter.com/salvbw/status/1245003572221071360
https://twitter.com/12SprprS/status/1238648677108858880
https://twitter.com/12SprprS/status/1237172172478545920
https://twitter.com/aikatsushake/status/1236348943589498880
https://twitter.com/12sprprs/status/1237172172478545920
https://twitter.com/ukke_tori/status/1244485200131706880
https://twitter.com/tonarifree/status/1245702447068110849
https://twitter.com/WTJJune/status/1245551192144408577
https://twitter.com/ChoBE_2/status/1245841373569277952
https://twitter.com/atyumuti/status/1245656134708428801
https://twitter.com/chobe_2/status/1245841373569277952
https://twitter.com/cloba377/status/1245999727302197248
https://twitter.com/llkamereon/status/1245980194248093703
https://twitter.com/HanbenP/status/1246009738162081792
https://twitter.com/LotPi174/status/1245946244272287749
https://twitter.com/benitaman/status/1209435026120568833
https://twitter.com/11nuudoru/status/1245553721624285184
https://twitter.com/benitaman/status/1240876181756338177
https://twitter.com/_mainon/status/1201008813798617088
https://twitter.com/11nuudoru/status/1245688874954702850
https://twitter.com/osakana_p_p/status/1246041366779408384
https://twitter.com/tiduru_39/status/1246057538988036102
https://twitter.com/masaki_kei/status/1244570076352638976
https://twitter.com/maro_pinky/status/1216734008786075649
https://twitter.com/chito_osushi/status/1246075313798279169
https://twitter.com/a_maru123/status/1245700611665874945
https://twitter.com/Shiro_Albino/status/1243437484492484608
https://twitter.com/niwatori_suzume/status/1238735059877646336
https://twitter.com/chyoling/status/1246034184730099717
https://twitter.com/HebiKujira/status/1240982098367762434
https://twitter.com/subachi/status/1246077025615400962


</pre>

<div id="ddd"></div>


	</body>
</html>
